<ion-content class="ion-padding dashboard-content">
  <!-- Create Order Card -->
  <ion-card class="edit-card">
    <ion-card-header>
      <ion-card-title class="card-title">Create New Order</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()" class="product-form">
        <div formArrayName="items">
          <div
            *ngFor="let row of items.controls; let i = index; trackBy: trackByIndex"
            [formGroupName]="i"
          >
            <ion-item class="form-item">
              <ion-label position="floating">Product</ion-label>
              <ion-select formControlName="productId" interface="popover">
                <ion-select-option
                  *ngFor="let p of products"
                  [value]="p.id"
                >
                  {{ p.name }} ({{ p.price | currency:'USD':'symbol':'1.2-2' }})
                </ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item class="form-item">
              <ion-label position="floating">Quantity</ion-label>
              <ion-input formControlName="quantity" type="number"></ion-input>
            </ion-item>

            <div class="form-actions">
              <ion-button
                *ngIf="items.length > 1"
                fill="outline"
                shape="round"
                class="cancel-button"
                (click)="removeItem(i)"
              >
                <ion-icon slot="start" name="remove-circle-outline"></ion-icon>
                Remove Item
              </ion-button>
            </div>
            <hr *ngIf="i < items.length - 1" />
          </div>
        </div>

        <div class="form-actions">
          <ion-button
            type="button"
            fill="outline"
            shape="round"
            class="cancel-button"
            (click)="addItem()"
          >
            <ion-icon slot="start" name="add-circle-outline"></ion-icon>
            Add Item
          </ion-button>

          <ion-button
            type="submit"
            shape="round"
            class="submit-button"
            [disabled]="form.invalid"
          >
            Create Order
          </ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- Orders List Card -->
  <ion-card class="products-card">
    <ion-card-header>
      <ion-card-title class="card-title">Order History</ion-card-title>
      <ion-card-subtitle class="card-subtitle">
        {{ orders.length }} orders placed
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <div class="table-container">
        <table class="products-table">
          <thead>
            <tr>
              <th class="id-column">Order #</th>
              <th class="name-column">Items</th>
              <th class="price-column">Total</th>
              <th class="date-column">Date</th>
              <th class="actions-column">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let o of paginatedOrders();
                trackBy: trackById
              "
            >
              <td class="id-cell">{{ o.id }}</td>
              <td class="name-cell">
                <div *ngFor="let p of o.products" class="order-item">
                  {{ p.name }} Ã— {{ p.OrderItem.quantity }}
                </div>
              </td>
              <td class="price-cell">
                {{ calculateOrderTotal(o) | currency:'USD':'symbol':'1.2-2' }}
              </td>
              <td class="date-cell">
                {{ o.createdAt | date:'short' }}
              </td>
              <td class="actions-cell">
                <ion-button
                  fill="clear"
                  class="action-button delete"
                  (click)="delete(o)"
                >
                  <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Controls -->
      <div class="pagination">
        <ion-button
          fill="outline"
          shape="round"
          (click)="prevPage()"
          [disabled]="currentPage === 1"
        >
          Previous
        </ion-button>

        <span>Page {{ currentPage }} of {{ totalPages() }}</span>

        <ion-button
          fill="outline"
          shape="round"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages()"
        >
          Next
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>
